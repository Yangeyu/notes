# 密码学基础与应用

## 密码学基本概念

- 密码学
  - 密码编制学
  - 密码分析学
- 安全目标
  - 保密性
    - 确保信息仅被合法用户访问，非授权用户不能访问
    - 技术
      - 防侦收
      - 防辐射
      - 数据加密
      - 物理保密
  - 完整性
    - 只能由授权用户进行数据修改，非授权用户不能改变数据
  - 可用性
    - 授权用户随时可以访问数据
      - 需满足
        - 身份鉴定、访问控制(进行权限控制)
- 攻击密码
  - 穷举攻击
    - 暴力破解-利用所有可能的密钥依次进行解密
  - 数学分析攻击
    - 针对加解密算法的数学基础和某些密码学特性，通过数学求解的方式进行破译
  - 基于物理攻击
    - 利用密码系统实现时泄漏的额外信息推倒，密码系统中的秘密参数
    - 功耗攻击、电磁场攻击和时间攻击
- 古典密码
  - 置换密码
    - 把明文中的字母重新排列，字母本身不变，其位置改变
  - 代替密码
    - 构造一个或多个密文字母表
    - 用密文字母表中的字母或字母组来代替明文中的字母或字母组
    - 相对位置不变，其本身的内容发生改变 
    - 加法密码
      - f(a~i~)= b~i~ = a~j~		j=i+k 	mod 	n
    - 乘法密码
      - f(a~i~)= b~i~ = a~j~		j=i*k	 mod	 n
    - 仿射密码
      - f(a~i~)= b~i~ = a~j~		j=i*k~1~ + k~0~
  - 代数密码
    - ![image-20200904131123111](/home/yang/.config/Typora/typora-user-images/image-20200904131123111.png)
- 古典密码破译方法
  - 穷举攻击
  - 统计分析
    - 分析明文和密文的统计规律来破解密码

## 分组密码

- ==分组密码==将M划分为一系列的明文块M~i~,通常每块包含若干位或字符，并且对每一块M~i~都用==同一个密钥K~e~==进行加密
- ==序列密码==将==明文和密钥==都划分为位(bit)或字符的序列，并且对明文序列中的每一位或字符都用密钥序列中的对应分量来加密
- 分组密码每一次加密一个明文块，而序列密码每一次加密一位或一个字符，`序列密码是要害部门使用的主流密码，而商用领域多用分组密码`

### DES算法

- IBM公司提交的一种加密算法
- 美国于1977-1-5颁布作为数据加密标准(`Data Encryption Standard, DES`)
- 设计目标：用于加密保护静态存储和传输信道中的数据，安全使用10-15年
- DES综合运用了置换、代替、代数等多种密码技术
  - DES是一种分组密码。明文、密文和密钥的分组长度都是64
  - DES是面向二进制的密码算法。可以加解密任何形式的计算机数据
  - DES是对合运算，加解密可以共用同一个算法，实现的工作减半
- DES加密过程
  - 64位密钥经子密钥产生算法产生16个子密钥，供1-16次加密迭代使用
  - 64位明文先经过初始置换IP，将数据打乱重新排列并分成左右两半。左边32位L~0~，右边32位构成R~0~
  - 由加密函数f实现子密钥K~1~对R~0~加密，结果为32位数据组f(R~0~, K~1~)。f(R~0~, K~1~)在与L~0~模2相加，作为第二次加密迭代的R~1~，R~0~作为第二次加密迭代的L~1~ 
  - 第16次加密迭代后，作为32位作为R~16~，右边32位作为L~16~，两者合并经过逆初始置换IP^-1^，将数据重新排列，得到密文
  - ![image-20200905095215560](/home/yang/.config/Typora/typora-user-images/image-20200905095215560.png)
  - ![image-20200905095232694](/home/yang/.config/Typora/typora-user-images/image-20200905095232694.png)
- 子密钥产生
  -  64位密钥经过置换选择1、循环左移、置换变换2等变换产生16个48位长的子密钥
  - ![image-20200905102720521](/home/yang/.config/Typora/typora-user-images/image-20200905102720521.png)
  - 置换选择1
    - 64位密钥分8字节。每个字节的前7位是真正的密钥位，第8位是奇偶校验位，可以从前7位计算得出，不起密钥作用。其作用是判断密是否存在错误，确保其完整性
    - 去掉奇偶校验位
    - 把其余56位打散28位作为C，28位作为D
    - 规定：![image-20200905103222592](/home/yang/.config/Typora/typora-user-images/image-20200905103222592.png)
  - 置换选择2
    - 将C和D合并位一个56位的中间数据
    - 从中选择48位子密钥K
    - 规定：![image-20200905103333097](/home/yang/.config/Typora/typora-user-images/image-20200905103333097.png)
  - 初始置换IP
    - DES第一步
    - 将64位明文打乱重排
    - ![image-20200905103513119](/home/yang/.config/Typora/typora-user-images/image-20200905103513119.png)
  - 加密函数f
    - 由选择运算E，代替函数组S和置换运算P组成
    - ![image-20200905103635421](/home/yang/.config/Typora/typora-user-images/image-20200905103635421.png)
    - 选择运算E
      - 对32位数据组A的各位进行选择和排序
      - 产生一个48位的结果
      - 矩阵：![image-20200905104149081](/home/yang/.config/Typora/typora-user-images/image-20200905104149081.png)
    - 代替函数组S
      - 6位输入、4位输出。1-8个S盒
      - 1、6位组成行号、其余4位组成列号
      - ![image-20200905104355443](/home/yang/.config/Typora/typora-user-images/image-20200905104355443.png)
      - S盒是一种非线性变换
    - 置换运算P
      - 把S盒输出的32位数据打乱重排，得到32位加密函数的输出
      - S-混淆、P-扩散
  - 逆初始置换
    - 初始置换的逆置换
    - 没有密钥参与
    - 确保加密算法的可逆性和对合性
  - DES解密过程
    - 共用同一个运算，子密钥使用顺序 ： 16-1
    - ![image-20200905105006656](/home/yang/.config/Typora/typora-user-images/image-20200905105006656.png)
  - DES不足
    - 密钥较短，采用56位密钥
    - 存在弱密钥
  - 三重DES(`3DES`)
    - 密钥长度168位
    - 底层加密算法与DES相同
    - 有DES基础的软硬件产品方便实现3DES
    - ==缺陷==：实现算法的速度比较慢

### `AES`算法

- 比利时学家提出`RIJNDAEL`作为AES
- ISO作为标准
- 安全、性能好、效率高、实用、灵活
- 数据块长度和密钥长度都可变的分组加密算法、都可独立选定为大于等于128位且小于等于256位的32位的任意倍数
- 美国颁布AES时规定数据块长度为128位、密钥长度可分别为128、192、256
- 采用分组密码的通用结构 - 对轮函数实施迭代的结构
- ![image-20200906093259076](/home/yang/.config/Typora/typora-user-images/image-20200906093259076.png)
  - 非线性层：进行非线性S盒变换`ByteSub`，由16个S盒并置而成，==混淆作用==
  - 线性混合层：进行行位移变换`ShiftRow`和列混合变换`MixColum`以确保多圈之上的高度扩散
  - 密钥加层：进行圈密钥加变换`AddRoundKey`,将圈密钥简单的异或到中间状态上，实现密钥的加密控制作用
- 状态
  - `RIJNDAEL`每一次变换操作产生一个中间结果，即中间状态
  - 4行Nb列，Nb = 数据块长度除以32(128/32=4)
  - ![image-20200906094506255](/home/yang/.config/Typora/typora-user-images/image-20200906094506255.png)
  - 在加密处理时，数据块按列优先的顺序写入状态，a~0,0~ , a~1,0~ , a~2,0~  ... 在加密操作结束时，密文按同样的顺序从状态中取出
  - ![image-20200906095124445](/home/yang/.config/Typora/typora-user-images/image-20200906095124445.png)
  - ![image-20200906095137890](/home/yang/.config/Typora/typora-user-images/image-20200906095137890.png)
- 轮函数
  - `RIJNDAEL`加密算法的轮函数采用代替/置换网络结构(SP结构)，由S盒变换`ByteSub`、行位移变换`ShiftRow`、列混合变换`MixColumn`、圈密钥加变换`AddRoundKey`组成
  - 最后一圈的轮函数去掉列混合变换`MixColumn`
    - S盒变换`ByteSub`
      - 是按字节进行代替变换。
      - 在状态中每个字节的一种非线性字节变换
        - 把字节的值用它的乘法逆来代替，其中‘00’的逆就是它自己
        - 经过1处理后的子字节值再进行如下定义的仿射变换
          - ![image-20200906100030595](/home/yang/.config/Typora/typora-user-images/image-20200906100030595.png)
      - S盒变换第一步是把字节的值用它的乘法逆来代替，是一种非线性变换
      - 系数矩阵每列都含有5个1，说明改变输入中的任意一位，将影响输出中的5位发生变化
      - 说明输出中的每一位，都与输入中的5位相关
      - `ByteSub`变换相当于DES中的S盒
      - `ByteSub变换必须是可逆的`，为了确保算法可逆
    - 行位移变换`ShiftRow`
      - 是对状态的行进行循环移位变换
    - 列混合变换`MixColumn`
      - 是对状态的列进行混合变换
      - ![image-20200906101407931](/home/yang/.config/Typora/typora-user-images/image-20200906101407931.png)
    - 圈密钥加变换`AddRoundKey`
      - 利用圈密钥对状态进行模2相加的变换
      - 长度等于数据块长度
- 圈密钥产生算法
  - 由用户密钥产生，两步：密钥扩展和圈密钥选择
    - 圈密钥的比特数为数据块长度与圈数加1的积
    - 首先将用户密钥扩展位一个扩展密钥
    - 在从扩展密钥选出圈密钥
  - 密钥扩展
    - ![image-20200906102117780](/home/yang/.config/Typora/typora-user-images/image-20200906102117780.png)
    - ![image-20200906102203257](/home/yang/.config/Typora/typora-user-images/image-20200906102203257.png)
  - 圈密钥选择
    - ![image-20200906102235268](/home/yang/.config/Typora/typora-user-images/image-20200906102235268.png)
- 加密算法
  - ![image-20200906102348653](/home/yang/.config/Typora/typora-user-images/image-20200906102348653.png)
- 解密 算法
  - ![image-20200906102430055](/home/yang/.config/Typora/typora-user-images/image-20200906102430055.png)
  - ![image-20200906102456533](/home/yang/.config/Typora/typora-user-images/image-20200906102456533.png)
- 安全性
  - ![image-20200906102632834](/home/yang/.config/Typora/typora-user-images/image-20200906102632834.png)

### `SM4`算法

- 06年我国密码管理局公布了无线局域网产品使用的`SM4`密码算法
- 分组算法，数据分组长度为128bit，密钥长度128bit。加密算法与密钥扩展算法都采用32论迭代结构
- 对和运算，加解密算法的结构相同，密钥的使用顺序相反
- 基本运算
  - 使用模2加和循环移位作为基本运算
  - ![image-20200907093210587](/home/yang/.config/Typora/typora-user-images/image-20200907093210587.png)
- 基本密码部件
  - S盒
    - 以字节为单位的非线性代替变换
    - 混淆作用
    - 输入和输出都是8为字节，本质是8位非线性置换
  - 非线性变换r
    - 以字为单位的非线性代替变换，由4个S盒并置构成。本质是S盒的一种并行应用
  - 线性变换部件L
    - 以字为处理单位的线性变换部件，其输入输出都是32位的字
    - 扩散作用
  - 合成变换T
    - 由非线性变换r盒线性变换L复合而而成，数据处理的单位是字
    - 混淆、扩散作用
- 轮函数利用基本密码部件，可构成轮函数，轮函数是一种以字位处理单位的密码函数
- 加密算法，每轮使用一个轮密钥
- 解密算法，与加密算法的结构相同，轮密钥的使用顺序相反
- 密钥扩展算法
  - 使用128位的加密密钥，并采用32轮迭代加密结构
  - 每轮加密使用一个32位的轮密钥，共使用32个
  - 总共要从加密密钥中产出32个轮密钥
  - 常数FK
    - ![image-20200907094427077](/home/yang/.config/Typora/typora-user-images/image-20200907094427077.png)
  - 固定参数CK
    - ![image-20200907094453883](/home/yang/.config/Typora/typora-user-images/image-20200907094453883.png)
  - 密钥扩展算法
    - ![image-20200907094939136](/home/yang/.config/Typora/typora-user-images/image-20200907094939136.png)
- 商用密码算法，主要用于无线局域网产品的安全保密

### 分组密码工作模式

- 电子代码本模式
  - 电码本模式 `ECB` 直接利用分组密码对明文的各分组进行加密
    - 要求数据的长度是密码分组长度的整数倍，否则最后一个数据块将是短块，这时需要特殊处理
    - 容易暴露明文的数据模式
- 输出反馈模式
  - 将分组密码转换为一个密钥序列产生器，实现分组密码按流密码的方式进行加解密
    - 安全性取决于分组密码本身的安全性
  - 没有错误传播，只影响对应位
- 密码反馈模式
  - 与输出反馈基本相同
  - ![image-20200914110200582](/home/yang/.config/Typora/typora-user-images/image-20200914110200582.png)
  - 解密时R和E按加密时同样的方式工作， 结合密文，便可产生出同样的密钥流，与密文异或完成解密
  - 存在错误传播无界的特性，使得密文反馈工作模式适合数据完整性认证方面的应用
- CTR模式
  - 把分组密码转化为序列密码，在本质上是利用分组密码产生密钥序列，按序列密码的方式进行加解密
  - ![image-20200914110725600](/home/yang/.config/Typora/typora-user-images/image-20200914110725600.png)
  - 加密算法是对合运算
  - 没有错误传播、不适合ihe用于数据完整性认证

## 序列密码

- 原理
  - 加解密采用简单的模2加分，使得序列密码的工程实现方便
  - 序列密码的关键是产生密钥序列的算法，具备产生随机性和不可预测性
  - ![image-20200914111657358](/home/yang/.config/Typora/typora-user-images/image-20200914111657358.png)
  - 